<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>Linux Â∫îÊÄ•ÂìçÂ∫îÊä•ÂëäÊü•ÁúãÂô® (Â¢ûÂº∫Áâà)</title>
<style>
body { 
  font-family: "Microsoft YaHei", Arial, sans-serif; 
  background: #f5f5f5; 
  margin: 0;
  padding: 0;
  height: 100vh;
  display: flex;
  flex-direction: column;
}

.header {
  background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
  color: white;
  padding: 20px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  position: sticky;
  top: 0;
  z-index: 1000;
}

.header h1 {
  margin: 0 0 15px 0;
  font-size: 2.2em;
}

.header .subtitle {
  font-size: 1.1em;
  opacity: 0.9;
}

.main-container {
  display: flex;
  flex: 1;
  overflow: hidden;
}

.content-container {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
}

.sidebar {
  width: 350px;
  background: #fff;
  border-left: 1px solid #e0e0e0;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.sidebar-header {
  padding: 15px;
  background: #f8f9fa;
  border-bottom: 1px solid #e0e0e0;
}

.alert-container {
  flex: 1;
  overflow-y: auto;
  padding: 15px;
}

.alert { 
  padding: 15px; 
  margin-bottom: 10px; 
  border-radius: 5px;
}

.alert-high { 
  background: #ffebee; 
  color: #c62828; 
  border-left: 5px solid #c62828; 
}

.alert-medium { 
  background: #fff3e0; 
  color: #ef6c00; 
  border-left: 5px solid #ef6c00; 
}

.alert-low { 
  background: #e3f2fd; 
  color: #1565c0; 
  border-left: 5px solid #1565c0; 
}

.alert-link { 
  cursor: pointer; 
  color: inherit; 
  text-decoration: underline; 
}

.alert-count { 
  background: #fff; 
  padding: 2px 8px; 
  border-radius: 10px; 
  margin-left: 10px; 
  font-size: 12px; 
}

.search-container {
  display: flex;
  align-items: center;
  gap: 10px;
  margin: 10px 0;
}

#searchInput {
  flex: 1;
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 3px;
  min-width: 200px;
}

.search-nav {
  display: flex;
  align-items: center;
  gap: 10px;
  white-space: nowrap;
}

.search-nav button {
  padding: 8px 15px;
  background: #2196F3;
  color: white;
  border: none;
  border-radius: 3px;
  cursor: pointer;
}

.search-nav button:hover {
  background: #1976D2;
}

.search-nav button:disabled {
  background: #ccc;
  cursor: not-allowed;
}

.tabs {
  overflow: hidden;
  background: #333;
  border-radius: 5px;
  margin-bottom: 10px;
  display: flex;
  flex-wrap: wrap;
}

.tabs button {
  background: #333;
  color: #fff;
  border: none;
  outline: none;
  cursor: pointer;
  padding: 14px 16px;
  transition: 0.3s;
  font-size: 14px;
  flex: 1;
  min-width: 120px;
}

.tabs button:hover {
  background: #ddd;
  color: black;
}

.tabs button.active {
  background: #2196F3;
  color: white;
}

.tabcontent {
  display: none;
  padding: 20px;
  background: #fff;
  border-radius: 5px;
  margin-top: 10px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.tabcontent pre {
  background: #222;
  color: #eee;
  padding: 15px;
  border-radius: 5px;
  overflow-x: auto;
  margin: 0;
  font-size: 14px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

.tabcontent details {
  margin-bottom: 15px;
  border: 1px solid #e0e0e0;
  border-radius: 5px;
}

.tabcontent summary {
  cursor: pointer;
  font-weight: bold;
  padding: 15px;
  background: #f8f9fa;
  border-radius: 5px 5px 0 0;
  border-bottom: 1px solid #e0e0e0;
  transition: background 0.3s;
}

.tabcontent summary:hover {
  background: #e9ecef;
}

.tabcontent details[open] summary {
  background: #007bff;
  color: white;
}

.mark {
  background: yellow;
  color: red;
  font-weight: bold;
}

.mark.current {
  background: #ff4444;
  color: white;
}

#fileInput {
  margin: 10px 0;
}

.alert-summary {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
  flex-wrap: wrap;
}

.alert-badge {
  padding: 8px 15px;
  border-radius: 20px;
  font-size: 13px;
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: bold;
}

.alert-badge.high {
  background: #ffebee;
  color: #c62828;
}

.alert-badge.medium {
  background: #fff3e0;
  color: #ef6c00;
}

.alert-badge.low {
  background: #e3f2fd;
  color: #1565c0;
}

.alert-badge .count {
  background: rgba(255,255,255,0.8);
  padding: 2px 8px;
  border-radius: 10px;
  font-size: 12px;
}

.collapse-button {
  padding: 5px 10px;
  background: none;
  border: 1px solid #ccc;
  border-radius: 3px;
  cursor: pointer;
  margin-left: auto;
}

.collapse-button:hover {
  background: #f0f0f0;
}

/* ÁªüËÆ°Èù¢ÊùøÊ†∑Âºè */
.stats-panel {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 20px;
  border-radius: 10px;
  margin-bottom: 20px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  margin-top: 15px;
}

.stat-item {
  background: rgba(255,255,255,0.1);
  padding: 15px;
  border-radius: 8px;
  text-align: center;
  backdrop-filter: blur(10px);
}

.stat-number {
  font-size: 2em;
  font-weight: bold;
  margin-bottom: 5px;
}

.stat-label {
  font-size: 0.9em;
  opacity: 0.9;
}

.risk-level {
  display: inline-block;
  padding: 5px 15px;
  border-radius: 20px;
  font-weight: bold;
  margin: 10px 0;
}

.risk-high { background: #ff4757; color: white; }
.risk-medium { background: #ffa502; color: white; }
.risk-low { background: #3742fa; color: white; }
.risk-normal { background: #2ed573; color: white; }

/* Âª∫ËÆÆÈù¢ÊùøÊ†∑Âºè */
.recommendations-panel {
  background: #f8f9fa;
  border-radius: 10px;
  padding: 20px;
  margin-bottom: 20px;
  border-left: 5px solid #28a745;
}

.recommendation-item {
  background: white;
  padding: 15px;
  margin-bottom: 10px;
  border-radius: 8px;
  border-left: 4px solid #007bff;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.recommendation-level {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 10px;
  font-size: 12px;
  font-weight: bold;
  margin-right: 10px;
}

.level-high { background: #ff4757; color: white; }
.level-medium { background: #ffa502; color: white; }
.level-low { background: #3742fa; color: white; }
.level-info { background: #2ed573; color: white; }

@keyframes highlight-pulse {
  0% { background: #ff4444; }
  50% { background: #ff8888; }
  100% { background: #ff4444; }
}

/* ÂìçÂ∫îÂºèËÆæËÆ° */
@media (max-width: 768px) {
  .main-container {
    flex-direction: column;
  }
  
  .sidebar {
    width: 100%;
    max-height: 300px;
  }
  
  .tabs {
    flex-direction: column;
  }
  
  .tabs button {
    flex: none;
  }
  
  .stats-grid {
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  }
}

</style>
<script>
const TAB_TITLES = {
  summary: "üìä ÁªüËÆ°ÂàÜÊûêÊÄªËßà",
  backdoor: "üîç Á≥ªÁªüÂêéÈó®ÊéíÊü•",
  user: "üë• Áî®Êà∑‰∏éÁôªÂΩïÊ£ÄÊü•",
  log: "üìã Êó•ÂøóÂàÜÊûê",
  network: "üåê ÁΩëÁªúÊ£ÄÊü•",
  process: "‚öôÔ∏è ËøõÁ®ãÊ£ÄÊü•",
  filesystem: "üìÅ Êñá‰ª∂Á≥ªÁªüÊ£ÄÊü•",
  package: "üì¶ ËΩØ‰ª∂ÂåÖÊ£ÄÊü•",
  persistence: "üîÑ ÊåÅ‰πÖÂåñÊ£ÄÊü•",
  integrity: "üõ°Ô∏è Á≥ªÁªüÂÆåÊï¥ÊÄß",
  malware: "ü¶† ÊÅ∂ÊÑèËøõÁ®ã‰∏éÊèêÊùÉÁÇπ"
};

const SUB_TAB_TITLES = {
  summary: ["Á≥ªÁªüÊ¶ÇËßà", "È£éÈô©ËØÑ‰º∞", "Êô∫ËÉΩÂª∫ËÆÆ", "Ê£ÄÊü•Ê∏ÖÂçï", "‰∏ì‰∏öÊÄªÁªì"],
  backdoor: ["UID‰∏∫0ÁöÑÈùûrootÁî®Êà∑", "ÂèØÁñëÁ≥ªÁªüÈÖçÁΩÆ", "ÂºÇÂ∏∏Á≥ªÁªüÊñá‰ª∂"],
  user: ["ÂΩìÂâçÁî®Êà∑", "ÊâÄÊúâÁî®Êà∑", "ÊúÄËøëÁôªÂΩïËÆ∞ÂΩï", "ÁôªÂΩïÂ§±Ë¥•ËÆ∞ÂΩï"],
  log: ["Á≥ªÁªüÊó•ÂøóÈîôËØØ", "ÂÆâÂÖ®Êó•ÂøóÈîôËØØ"],
  network: ["ÁõëÂê¨Á´ØÂè£", "Ê¥ªÂä®ËøûÊé•", "ÁΩëÁªúÈÖçÁΩÆ", "Ë∑ØÁî±Ë°®", "ÂèØÁñëËøûÊé•"],
  process: ["È´òCPUÂç†Áî®ËøõÁ®ã", "ÂèØÁñëËÑöÊú¨ËøõÁ®ã"],
  filesystem: ["SUIDÊñá‰ª∂", "ÊúÄËøë‰øÆÊîπÁöÑÊñá‰ª∂"],
  package: ["Â∑≤ÂÆâË£ÖÁöÑËΩØ‰ª∂ÂåÖ"],
  persistence: ["Ëá™ÂêØÂä®ÊúçÂä°", "ËÆ°Âàí‰ªªÂä°", "SSHÂÖ¨Èí•", "ÂêØÂä®È°πÈÖçÁΩÆ"],
  integrity: ["ÂÖ≥ÈîÆ‰∫åËøõÂà∂Êñá‰ª∂Ê†°È™å", "Á≥ªÁªüÊñá‰ª∂ÂÆåÊï¥ÊÄß"],
  malware: ["ÂèØÁñëËøõÁ®ã", "ÂèØÁñëÊèêÊùÉÁÇπ", "ÈöêËóèÊñá‰ª∂"]
};

let gTabs = Object.keys(TAB_TITLES);
let gContent = "";
let currentSearchIndex = -1;
let searchResults = [];
let analysisData = null;

// ÂëäË≠¶ÁªìÊûúÂ≠òÂÇ®
let alertResults = {
  high: [],
  medium: [],
  low: []
};

// ÁªüËÆ°Êï∞ÊçÆÂ≠òÂÇ®
let systemStats = {
  total_users: 0,
  uid0_users: 0,
  listening_ports: 0,
  suspicious_processes: 0,
  suid_files: 0,
  recent_files: 0,
  failed_logins: 0,
  cron_jobs: 0,
  risk_score: 0,
  risk_level: 'NORMAL'
};

function parseTextReport(text) {
  const sections = text.split("##########################################");
  const data = {};
  let currentSection = null;
  
  for (const section of sections) {
    if (!section.trim()) continue;
    
    const moduleMatch = section.match(/Ê®°Âùó: (.*?)\n/);
    if (!moduleMatch) continue;
    
    const moduleTitle = moduleMatch[1];
    const moduleKey = Object.keys(TAB_TITLES).find(key => TAB_TITLES[key].includes(moduleTitle) || TAB_TITLES[key] === moduleTitle);
    if (!moduleKey) continue;
    
    const subSections = section.split("------------------------------------------");
    data[moduleKey] = {};
    
    for (let i = 1; i < subSections.length; i += 2) {
      const titleMatch = subSections[i].match(/Â≠êÈ°π: (.*?)\n/);
      if (!titleMatch) continue;
      const title = titleMatch[1];
      const content = subSections[i + 1] ? subSections[i + 1].trim() : "";
      data[moduleKey][title] = content;
    }
  }
  
  return data;
}

// ÁîüÊàêÁªüËÆ°ÂàÜÊûê
function generateStatistics(data) {
  const stats = {
    system_overview: {},
    security_summary: {},
    risk_assessment: {},
    recommendations: []
  };
  
  // ÈáçÁΩÆÁªüËÆ°Êï∞ÊçÆ
  systemStats = {
    total_users: 0,
    uid0_users: 0,
    listening_ports: 0,
    suspicious_processes: 0,
    suid_files: 0,
    recent_files: 0,
    failed_logins: 0,
    cron_jobs: 0,
    risk_score: 0,
    risk_level: 'NORMAL'
  };
  
  // Áî®Êà∑ÁªüËÆ°
  if (data.user && data.user['ÊâÄÊúâÁî®Êà∑']) {
    const users = data.user['ÊâÄÊúâÁî®Êà∑'].split('\n').filter(u => u.trim());
    systemStats.total_users = users.length;
  }
  
  if (data.backdoor && data.backdoor['UID‰∏∫0ÁöÑÈùûrootÁî®Êà∑']) {
    const uid0Content = data.backdoor['UID‰∏∫0ÁöÑÈùûrootÁî®Êà∑'];
    systemStats.uid0_users = (uid0Content.match(/ÂèØÁñëUID 0Áî®Êà∑/g) || []).length;
  }
  
  // ÁΩëÁªúÁªüËÆ°
  if (data.network && data.network['ÁõëÂê¨Á´ØÂè£']) {
    const ports = data.network['ÁõëÂê¨Á´ØÂè£'];
    systemStats.listening_ports = (ports.match(/LISTEN|:/g) || []).length;
  }
  
  // ËøõÁ®ãÁªüËÆ°
  if (data.process && data.process['ÂèØÁñëËÑöÊú¨ËøõÁ®ã']) {
    const processes = data.process['ÂèØÁñëËÑöÊú¨ËøõÁ®ã'].split('\n').filter(p => p.trim());
    systemStats.suspicious_processes = processes.length;
  }
  
  // Êñá‰ª∂Á≥ªÁªüÁªüËÆ°
  if (data.filesystem && data.filesystem['SUIDÊñá‰ª∂']) {
    const suidFiles = data.filesystem['SUIDÊñá‰ª∂'];
    systemStats.suid_files = (suidFiles.match(/-rws/g) || []).length;
  }
  
  if (data.filesystem && data.filesystem['ÊúÄËøë‰øÆÊîπÁöÑÊñá‰ª∂']) {
    const recentFiles = data.filesystem['ÊúÄËøë‰øÆÊîπÁöÑÊñá‰ª∂'].split('\n').filter(f => f.trim());
    systemStats.recent_files = recentFiles.length;
  }
  
  // ÁôªÂΩïÂ§±Ë¥•ÁªüËÆ°
  if (data.user && data.user['ÁôªÂΩïÂ§±Ë¥•ËÆ∞ÂΩï']) {
    const failedLogins = data.user['ÁôªÂΩïÂ§±Ë¥•ËÆ∞ÂΩï'];
    systemStats.failed_logins = (failedLogins.match(/Failed password/g) || []).length;
  }
  
  // ËÆ°Âàí‰ªªÂä°ÁªüËÆ°
  if (data.persistence && data.persistence['ËÆ°Âàí‰ªªÂä°']) {
    const cronJobs = data.persistence['ËÆ°Âàí‰ªªÂä°'];
    systemStats.cron_jobs = (cronJobs.match(/crontab|cron|\*/g) || []).length;
  }
  
  // È£éÈô©ËØÑÂàÜËÆ°ÁÆó
  let riskScore = 0;
  const recommendations = [];
  
  if (systemStats.uid0_users > 0) {
    riskScore += 50;
    recommendations.push({
      level: 'high',
      title: 'ÂèëÁé∞ÂºÇÂ∏∏È´òÊùÉÈôêÁî®Êà∑',
      description: `ÂèëÁé∞ ${systemStats.uid0_users} ‰∏™ÈùûrootÁöÑUID‰∏∫0Áî®Êà∑ÔºåËøôÂèØËÉΩÊòØÂÆâÂÖ®Â®ÅËÉÅ„ÄÇ`,
      action: 'Âª∫ËÆÆÁ´ãÂç≥‰∏éËøêÁª¥ÂíåÂºÄÂèë‰∫∫ÂëòÁ°ÆËÆ§Ëøô‰∫õÁî®Êà∑ÁöÑÂêàÊ≥ïÊÄßÔºåÂ¶ÇÊó†Ê≥ïÁ°ÆËÆ§Â∫îÁ´ãÂç≥Á¶ÅÁî®„ÄÇ'
    });
  } else {
    recommendations.push({
      level: 'info',
      title: 'Áî®Êà∑ÊùÉÈôêÊ£ÄÊü•Ê≠£Â∏∏',
      description: `Á≥ªÁªüÂÖ±Êúâ ${systemStats.total_users} ‰∏™Áî®Êà∑Ë¥¶Êà∑ÔºåÈô§rootÂ§ñÊú™ÂèëÁé∞ÂÖ∂‰ªñUID‰∏∫0ÁöÑÈ´òÊùÉÈôêÁî®Êà∑ÔºåËøôÊòØËâØÂ•ΩÁöÑÂÆâÂÖ®ÂÆûË∑µ„ÄÇ`,
      action: 'Âª∫ËÆÆÂÆöÊúüÂÆ°Êü•Áî®Êà∑Ë¥¶Êà∑ÔºåÁ°Æ‰øùÊùÉÈôêÂàÜÈÖçÂêàÁêÜ„ÄÇ'
    });
  }
  
  if (systemStats.suspicious_processes > 10) {
    riskScore += 30;
    recommendations.push({
      level: 'medium',
      title: 'ÂèØÁñëËøõÁ®ãÊï∞ÈáèÂºÇÂ∏∏',
      description: `ÂèëÁé∞ ${systemStats.suspicious_processes} ‰∏™ÂèØÁñëËÑöÊú¨ËøõÁ®ãÔºåÊï∞ÈáèËæÉÂ§ö„ÄÇ`,
      action: 'Âª∫ËÆÆÊ£ÄÊü•Ëøô‰∫õËøõÁ®ãÁöÑÂêàÊ≥ïÊÄßÔºåÁ°ÆËÆ§ÂÖ∂‰∏öÂä°ÂøÖË¶ÅÊÄß„ÄÇ'
    });
  } else if (systemStats.suspicious_processes > 0) {
    recommendations.push({
      level: 'low',
      title: 'ÂèëÁé∞Â∞ëÈáèÂèØÁñëËøõÁ®ã',
      description: `ÂèëÁé∞ ${systemStats.suspicious_processes} ‰∏™ÂèØÁñëËÑöÊú¨ËøõÁ®ã„ÄÇ`,
      action: 'Âª∫ËÆÆÁ°ÆËÆ§Ëøô‰∫õËøõÁ®ãÁöÑ‰∏öÂä°ÂøÖË¶ÅÊÄß„ÄÇ'
    });
  }
  
  if (systemStats.suid_files > 100) {
    riskScore += 20;
    recommendations.push({
      level: 'medium',
      title: 'SUIDÊñá‰ª∂Êï∞ÈáèÂºÇÂ∏∏',
      description: `ÂèëÁé∞ ${systemStats.suid_files} ‰∏™SUIDÊñá‰ª∂ÔºåÊï∞ÈáèËæÉÂ§ö„ÄÇ`,
      action: 'Âª∫ËÆÆÂÆ°Êü•SUIDÊñá‰ª∂ÂàóË°®ÔºåÁ°ÆËÆ§ÊòØÂê¶Â≠òÂú®ÂºÇÂ∏∏ÁöÑÊèêÊùÉÊñá‰ª∂„ÄÇ'
    });
  }
  
  if (systemStats.failed_logins > 50) {
    riskScore += 25;
    recommendations.push({
      level: 'medium',
      title: 'ÁôªÂΩïÂ§±Ë¥•Ê¨°Êï∞ÂºÇÂ∏∏',
      description: `ÁôªÂΩïÂ§±Ë¥•Ê¨°Êï∞(${systemStats.failed_logins})ËæÉÂ§öÔºåÂèØËÉΩÂ≠òÂú®Êö¥ÂäõÁ†¥Ëß£ÊîªÂáª„ÄÇ`,
      action: 'Âª∫ËÆÆÊ£ÄÊü•ÁôªÂΩïÊó•ÂøóÔºåÂä†Âº∫ÂØÜÁ†ÅÁ≠ñÁï•ÂíåËÆøÈóÆÊéßÂà∂„ÄÇ'
    });
  }
  
  if (systemStats.listening_ports > 20) {
    riskScore += 15;
    recommendations.push({
      level: 'low',
      title: 'ÁõëÂê¨Á´ØÂè£Êï∞ÈáèËæÉÂ§ö',
      description: `ÁõëÂê¨Á´ØÂè£Êï∞Èáè(${systemStats.listening_ports})ËæÉÂ§ö„ÄÇ`,
      action: 'Âª∫ËÆÆÂÖ≥Èó≠‰∏çÂøÖË¶ÅÁöÑÊúçÂä°‰ª•ÂáèÂ∞ëÊîªÂáªÈù¢„ÄÇ'
    });
  }
  
  // Á°ÆÂÆöÈ£éÈô©Á≠âÁ∫ß
  if (riskScore >= 80) {
    systemStats.risk_level = 'HIGH';
  } else if (riskScore >= 50) {
    systemStats.risk_level = 'MEDIUM';
  } else if (riskScore >= 20) {
    systemStats.risk_level = 'LOW';
  } else {
    systemStats.risk_level = 'NORMAL';
  }
  
  systemStats.risk_score = riskScore;
  
  return {
    statistics: systemStats,
    recommendations: recommendations
  };
}

// ÁîüÊàêÁªüËÆ°ÊÄªËßàÂÜÖÂÆπ
function generateSummaryContent(data) {
  const analysis = generateStatistics(data);
  const stats = analysis.statistics;
  const recommendations = analysis.recommendations;
  
  const summaryData = {
    'Á≥ªÁªüÊ¶ÇËßà': `
=== Á≥ªÁªüÂü∫Êú¨‰ø°ÊÅØ ===
Ê£ÄÊü•Êó∂Èó¥: ${new Date().toLocaleString()}
ÊÄªÁî®Êà∑Êï∞: ${stats.total_users}
UID‰∏∫0ÁöÑÈùûrootÁî®Êà∑: ${stats.uid0_users}
ÁõëÂê¨Á´ØÂè£Êï∞: ${stats.listening_ports}
ÂèØÁñëËøõÁ®ãÊï∞: ${stats.suspicious_processes}
SUIDÊñá‰ª∂Êï∞: ${stats.suid_files}
ÊúÄËøë‰øÆÊîπÊñá‰ª∂Êï∞: ${stats.recent_files}
ÁôªÂΩïÂ§±Ë¥•Ê¨°Êï∞: ${stats.failed_logins}
ËÆ°Âàí‰ªªÂä°Êï∞: ${stats.cron_jobs}

=== È£éÈô©ËØÑ‰º∞ ===
È£éÈô©ËØÑÂàÜ: ${stats.risk_score}
È£éÈô©Á≠âÁ∫ß: ${stats.risk_level}
    `,
    
    'È£éÈô©ËØÑ‰º∞': `
=== È£éÈô©Á≠âÁ∫ßËØ¥Êòé ===
NORMAL (0-19ÂàÜ): Á≥ªÁªüÂÆâÂÖ®Áä∂ÂÜµËâØÂ•Ω
LOW (20-49ÂàÜ): Â≠òÂú®ËΩªÂæÆÂÆâÂÖ®È£éÈô©
MEDIUM (50-79ÂàÜ): Â≠òÂú®‰∏≠Á≠âÂÆâÂÖ®È£éÈô©ÔºåÈúÄË¶ÅÂÖ≥Ê≥®
HIGH (80+ÂàÜ): Â≠òÂú®‰∏•ÈáçÂÆâÂÖ®È£éÈô©ÔºåÈúÄË¶ÅÁ´ãÂç≥Â§ÑÁêÜ

=== ÂΩìÂâçÈ£éÈô©ÂàÜÊûê ===
ÊÄªËØÑÂàÜ: ${stats.risk_score} ÂàÜ
È£éÈô©Á≠âÁ∫ß: ${stats.risk_level}

ËØÑÂàÜÊûÑÊàê:
- UID‰∏∫0ÂºÇÂ∏∏Áî®Êà∑: ${stats.uid0_users > 0 ? '+50ÂàÜ (È´òÂç±)' : '0ÂàÜ (Ê≠£Â∏∏)'}
- ÂèØÁñëËøõÁ®ãËøáÂ§ö: ${stats.suspicious_processes > 10 ? '+30ÂàÜ (‰∏≠Âç±)' : stats.suspicious_processes > 0 ? '+10ÂàÜ (‰ΩéÂç±)' : '0ÂàÜ (Ê≠£Â∏∏)'}
- SUIDÊñá‰ª∂ÂºÇÂ∏∏: ${stats.suid_files > 100 ? '+20ÂàÜ (‰∏≠Âç±)' : '0ÂàÜ (Ê≠£Â∏∏)'}
- ÁôªÂΩïÂ§±Ë¥•ËøáÂ§ö: ${stats.failed_logins > 50 ? '+25ÂàÜ (‰∏≠Âç±)' : '0ÂàÜ (Ê≠£Â∏∏)'}
- ÁõëÂê¨Á´ØÂè£ËøáÂ§ö: ${stats.listening_ports > 20 ? '+15ÂàÜ (‰ΩéÂç±)' : '0ÂàÜ (Ê≠£Â∏∏)'}
    `,
    
    'Êô∫ËÉΩÂª∫ËÆÆ': recommendations.map(rec => 
      `[${rec.level.toUpperCase()}] ${rec.title}\n${rec.description}\nÂ§ÑÁΩÆÂª∫ËÆÆ: ${rec.action}`
    ).join('\n\n'),
    
    'Ê£ÄÊü•Ê∏ÖÂçï': generateProfessionalSummary(data, stats),
    
    '‰∏ì‰∏öÊÄªÁªì': generateIncidentResponseSummary(data, stats)
  };
  
  return summaryData;
}

// ÁîüÊàê‰∏ì‰∏öÊ£ÄÊü•Ê∏ÖÂçï
function generateProfessionalSummary(data, stats) {
  return `
=== Â∫îÊÄ•ÂìçÂ∫îÊ£ÄÊü•Ê∏ÖÂçï (Âü∫‰∫éNIST SP 800-61Ê°ÜÊû∂) ===

„ÄêÂáÜÂ§áÈò∂ÊÆµ - Preparation„Äë
‚ñ° 1. Á°ÆËÆ§Â∫îÊÄ•ÂìçÂ∫îÂõ¢ÈòüËÅîÁ≥ªÊñπÂºèÂíåËÅåË¥£ÂàÜÂ∑•
‚ñ° 2. È™åËØÅÂ§á‰ªΩÁ≥ªÁªüÂíåÊÅ¢Â§çÁ®ãÂ∫èÁöÑÂèØÁî®ÊÄß
‚ñ° 3. Á°Æ‰øùÊó•ÂøóËÆ∞ÂΩïÂíåÁõëÊéßÁ≥ªÁªüÊ≠£Â∏∏ËøêË°å

„ÄêÊ£ÄÊµã‰∏éÂàÜÊûêÈò∂ÊÆµ - Detection & Analysis„Äë
‚ñ° 4. Á°ÆËÆ§ÊâÄÊúâUID‰∏∫0ÁöÑÁî®Êà∑ÂêàÊ≥ïÊÄß ${stats.uid0_users > 0 ? '‚ö†Ô∏è ÂèëÁé∞ÂºÇÂ∏∏' : '‚úÖ Ê≠£Â∏∏'}
‚ñ° 5. ÂàÜÊûêÂèØÁñëËøõÁ®ãÁöÑ‰∏öÂä°ÂøÖË¶ÅÊÄß ${stats.suspicious_processes > 10 ? '‚ö†Ô∏è Êï∞ÈáèÂºÇÂ∏∏' : '‚úÖ Ê≠£Â∏∏ËåÉÂõ¥'}
‚ñ° 6. ÂÆ°Êü•SUIDÊñá‰ª∂ÊòØÂê¶Â≠òÂú®ÂºÇÂ∏∏ÊèêÊùÉÁÇπ
‚ñ° 7. ÂàÜÊûêÁôªÂΩïÂ§±Ë¥•Êó•ÂøóÔºåËØÜÂà´ÊΩúÂú®ÁöÑÊö¥ÂäõÁ†¥Ëß£ÊîªÂáª ${stats.failed_logins > 50 ? '‚ö†Ô∏è Â§±Ë¥•Ê¨°Êï∞ËøáÂ§ö' : '‚úÖ Ê≠£Â∏∏'}
‚ñ° 8. Ê£ÄÊü•ÁΩëÁªúËøûÊé•ÂíåÁõëÂê¨Á´ØÂè£ÁöÑÂêàÊ≥ïÊÄß ${stats.listening_ports > 20 ? '‚ö†Ô∏è Á´ØÂè£ËæÉÂ§ö' : '‚úÖ Ê≠£Â∏∏'}

„ÄêÈÅèÂà∂Èò∂ÊÆµ - Containment„Äë
‚ñ° 9. ÈöîÁ¶ªÂèØÁñëÁ≥ªÁªüÂíåÁΩëÁªúËøûÊé•
‚ñ° 10. ‰øùÊä§ÂÖ≥ÈîÆÊï∞ÊçÆÂíåÁ≥ªÁªüËµÑÊ∫ê
‚ñ° 11. Êî∂ÈõÜÂíå‰øùÂ≠òÊï∞Â≠óËØÅÊçÆ

„ÄêÊ†πÈô§Èò∂ÊÆµ - Eradication„Äë
‚ñ° 12. Ê∏ÖÈô§ÊÅ∂ÊÑèËΩØ‰ª∂ÂíåÂêéÈó®Á®ãÂ∫è
‚ñ° 13. ‰øÆÂ§çÁ≥ªÁªüÊºèÊ¥ûÂíåÂÆâÂÖ®ÈÖçÁΩÆ
‚ñ° 14. Êõ¥Êñ∞Á≥ªÁªüË°•‰∏ÅÂíåÂÆâÂÖ®Á≠ñÁï•

„ÄêÊÅ¢Â§çÈò∂ÊÆµ - Recovery„Äë
‚ñ° 15. È™åËØÅÁ≥ªÁªüÂÆåÊï¥ÊÄßÂíåÂäüËÉΩÊ≠£Â∏∏
‚ñ° 16. ÊÅ¢Â§ç‰∏öÂä°ÊúçÂä°ÂíåÊï∞ÊçÆËÆøÈóÆ
‚ñ° 17. Âä†Âº∫ÁõëÊéßÂíåÊó•ÂøóËÆ∞ÂΩï

„Äê‰∫ãÂêéÊ¥ªÂä® - Post-Incident Activity„Äë
‚ñ° 18. ÁºñÂÜôËØ¶ÁªÜÁöÑ‰∫ã‰ª∂Êä•Âëä
‚ñ° 19. ÊÄªÁªìÁªèÈ™åÊïôËÆ≠ÂíåÊîπËøõÂª∫ËÆÆ
‚ñ° 20. Êõ¥Êñ∞Â∫îÊÄ•ÂìçÂ∫îÁ®ãÂ∫èÂíåÈ¢ÑÊ°à

=== ‰ºòÂÖàÁ∫ßÂ§ÑÁêÜÂª∫ËÆÆ ===
${stats.uid0_users > 0 ? 'üî¥ Á¥ßÊÄ• (P0): Á´ãÂç≥Â§ÑÁêÜUID‰∏∫0ÂºÇÂ∏∏Áî®Êà∑ÔºåÂèØËÉΩÂ≠òÂú®ÊùÉÈôêÊèêÂçáÂ®ÅËÉÅ' : ''}
${stats.risk_score >= 80 ? 'üî¥ È´òÂç± (P1): Á≥ªÁªüÂ≠òÂú®‰∏•ÈáçÂÆâÂÖ®È£éÈô©ÔºåÈúÄË¶ÅÁ´ãÂç≥ÂìçÂ∫î' : ''}
${stats.risk_score >= 50 && stats.risk_score < 80 ? 'üü° ‰∏≠Âç± (P2): Â≠òÂú®ÂÆâÂÖ®ÈöêÊÇ£ÔºåÂª∫ËÆÆ24Â∞èÊó∂ÂÜÖÂ§ÑÁêÜ' : ''}
${stats.risk_score >= 20 && stats.risk_score < 50 ? 'üü¢ ‰ΩéÂç± (P3): ‰ºòÂåñÂÆâÂÖ®ÈÖçÁΩÆÔºåÂª∫ËÆÆ72Â∞èÊó∂ÂÜÖÂ§ÑÁêÜ' : ''}
${stats.risk_score < 20 ? '‚úÖ Ê≠£Â∏∏ (P4): Á≥ªÁªüÂÆâÂÖ®Áä∂ÂÜµËâØÂ•ΩÔºåÂª∫ËÆÆÂÆöÊúüÊ£ÄÊü•Áª¥Êä§' : ''}
  `;
}

// ÁîüÊàê‰∏ì‰∏öÁöÑ‰∫ã‰ª∂ÂìçÂ∫îÊÄªÁªì
function generateIncidentResponseSummary(data, stats) {
  const currentTime = new Date().toLocaleString();
  
  // ÂàÜÊûêÂ∑≤Á°ÆËÆ§ÂÆâÂÖ®ÁöÑÈ°πÁõÆ
  const secureItems = [];
  if (stats.uid0_users === 0) secureItems.push('Áî®Êà∑ÊùÉÈôêÈÖçÁΩÆ');
  if (stats.failed_logins < 10) secureItems.push('ÁôªÂΩïÂÆâÂÖ®Áä∂ÂÜµ');
  if (stats.suspicious_processes < 5) secureItems.push('ËøõÁ®ãËøêË°åÁä∂ÊÄÅ');
  
  // ÈúÄË¶Å‰∏éËøêÁª¥Á°ÆËÆ§ÁöÑÈ°πÁõÆ
  const confirmItems = [];
  if (stats.listening_ports > 10) confirmItems.push(`ÁΩëÁªúÊúçÂä°ÈÖçÁΩÆ(${stats.listening_ports}‰∏™ÁõëÂê¨Á´ØÂè£)`);
  if (stats.cron_jobs > 5) confirmItems.push(`ËÆ°Âàí‰ªªÂä°ÈÖçÁΩÆ(${stats.cron_jobs}‰∏™‰ªªÂä°)`);
  if (stats.suid_files > 50) confirmItems.push(`SUIDÊñá‰ª∂ÊùÉÈôê(${stats.suid_files}‰∏™Êñá‰ª∂)`);
  
  // Â∑≤Á°ÆËÆ§Â≠òÂú®Â®ÅËÉÅÁöÑÈ°πÁõÆ
  const threatItems = [];
  if (stats.uid0_users > 0) threatItems.push(`ÂºÇÂ∏∏È´òÊùÉÈôêÁî®Êà∑(${stats.uid0_users}‰∏™)`);
  if (stats.failed_logins > 50) threatItems.push(`Êö¥ÂäõÁ†¥Ëß£ÊîªÂáªËøπË±°(${stats.failed_logins}Ê¨°Â§±Ë¥•)`);
  
  // Êú™ÂÆåÊàêÊ£ÄÊü•ÁöÑÈ°πÁõÆ
  const pendingItems = [
    'Ê∑±Â∫¶ÊÅ∂ÊÑèËΩØ‰ª∂Êâ´Êèè',
    'ÁΩëÁªúÊµÅÈáèÂºÇÂ∏∏ÂàÜÊûê',
    'Êñá‰ª∂ÂÆåÊï¥ÊÄßÊ∑±Â∫¶Ê†°È™å',
    'ÂÜÖÂ≠òËΩ¨ÂÇ®ÂàÜÊûê',
    'Á≥ªÁªüË∞ÉÁî®ÂÆ°ËÆ°'
  ];
  
  return `
=== ÁΩëÁªúÂÆâÂÖ®‰∫ã‰ª∂ÂìçÂ∫îÊÄªÁªìÊä•Âëä ===
Êä•ÂëäÁîüÊàêÊó∂Èó¥: ${currentTime}
ÂàÜÊûêÂ∏à: Ëá™Âä®ÂåñÂ∫îÊÄ•ÂìçÂ∫îÁ≥ªÁªü
‰∫ã‰ª∂Á≠âÁ∫ß: ${stats.risk_level} (ËØÑÂàÜ: ${stats.risk_score}/100)

„ÄêÊâßË°åÊëòË¶Å - Executive Summary„Äë
Êú¨Ê¨°Â∫îÊÄ•ÂìçÂ∫îÊ£ÄÊü•Âü∫‰∫éNIST SP 800-61ÁΩëÁªúÂÆâÂÖ®‰∫ã‰ª∂Â§ÑÁêÜÊåáÂçóÊâßË°åÔºåÈááÁî®Ê†áÂáÜÂåñÁöÑÊ£ÄÊµã„ÄÅÂàÜÊûê„ÄÅÈÅèÂà∂„ÄÅÊ†πÈô§„ÄÅÊÅ¢Â§çÊµÅÁ®ã„ÄÇÈÄöËøáËá™Âä®ÂåñÂ∑•ÂÖ∑ÂØπÁõÆÊ†áÁ≥ªÁªüËøõË°å‰∫ÜÂÖ®Èù¢ÁöÑÂÆâÂÖ®ÊÄÅÂäøËØÑ‰º∞„ÄÇ

„ÄêÂ∑≤Á°ÆËÆ§ÂÆâÂÖ®ÁöÑÊ£ÄÊü•È°πÁõÆ - Verified Secure Items„Äë
${secureItems.length > 0 ? secureItems.map(item => `‚úÖ ${item}: ÁªèÊ£ÄÊü•Á°ÆËÆ§Á¨¶ÂêàÂÆâÂÖ®Âü∫Á∫øË¶ÅÊ±Ç`).join('\n') : '‚ö†Ô∏è ÊöÇÊó†ÂÆåÂÖ®Á°ÆËÆ§ÂÆâÂÖ®ÁöÑÈ°πÁõÆÔºåÂª∫ËÆÆËøõ‰∏ÄÊ≠•Ê∑±ÂÖ•ÂàÜÊûê'}

„ÄêÈúÄË¶ÅËøêÁª¥Á°ÆËÆ§ÁöÑ‰∏öÂä°ÂêàËßÑÊÄßÈ°πÁõÆ - Items Requiring Operational Validation„Äë
${confirmItems.length > 0 ? confirmItems.map(item => `üîç ${item}: Âª∫ËÆÆ‰∏éËøêÁª¥Âõ¢ÈòüÁ°ÆËÆ§‰∏öÂä°ÂêàËßÑÊÄßÂíåÂøÖË¶ÅÊÄß`).join('\n') : '‚úÖ ÊâÄÊúâÈÖçÁΩÆÈ°πÁõÆÂùáÂú®Ê≠£Â∏∏ËåÉÂõ¥ÂÜÖ'}

„ÄêÂ∑≤ËØÜÂà´ÁöÑÂÆâÂÖ®Â®ÅËÉÅ - Confirmed Security Threats„Äë
${threatItems.length > 0 ? threatItems.map(item => `üö® ${item}: Â∑≤Á°ÆËÆ§Â≠òÂú®ÂÆâÂÖ®È£éÈô©ÔºåÂª∫ËÆÆÁ´ãÂç≥ÈááÂèñÈÅèÂà∂Êé™ÊñΩ`).join('\n') : '‚úÖ Êú™ÂèëÁé∞ÊòéÁ°ÆÁöÑÂÆâÂÖ®Â®ÅËÉÅÊåáÊ†á'}

„ÄêÂæÖÊ∑±ÂÖ•Ê£ÄÊü•ÁöÑÈ°πÁõÆ - Pending Advanced Analysis„Äë
${pendingItems.map(item => `‚è≥ ${item}: Âª∫ËÆÆ‰ΩøÁî®‰∏ì‰∏öÂ∑•ÂÖ∑ËøõË°åÊ∑±Â∫¶ÂàÜÊûê`).join('\n')}

„ÄêÂª∫ËÆÆÂêéÁª≠Ë°åÂä® - Recommended Next Actions„Äë
1. „ÄêÁ´ãÂç≥Ë°åÂä®„ÄëÈíàÂØπÂ∑≤ËØÜÂà´Â®ÅËÉÅÊâßË°åÈÅèÂà∂ÂíåÊ†πÈô§Êé™ÊñΩ
2. „Äê24Â∞èÊó∂ÂÜÖ„Äë‰∏éËøêÁª¥Âõ¢ÈòüÁ°ÆËÆ§ÂèØÁñëÈÖçÁΩÆÁöÑ‰∏öÂä°ÂêàËßÑÊÄß
3. „Äê72Â∞èÊó∂ÂÜÖ„ÄëÊâßË°åÊ∑±Â∫¶ÂÆâÂÖ®Êâ´ÊèèÂíåÂ®ÅËÉÅÁã©ÁåéÊ¥ªÂä®
4. „Äê‰∏ÄÂë®ÂÜÖ„ÄëÊõ¥Êñ∞ÂÆâÂÖ®Âü∫Á∫øÂíåÁõëÊéßËßÑÂàô
5. „ÄêÊåÅÁª≠ÁõëÊéß„ÄëÂä†Âº∫Êó•ÂøóÂàÜÊûêÂíåÂºÇÂ∏∏Ë°å‰∏∫Ê£ÄÊµã

„ÄêÂêàËßÑÊÄßÂ£∞Êòé - Compliance Statement„Äë
Êú¨Ê¨°Ê£ÄÊü•ÈÅµÂæ™‰ª•‰∏ãÂÆâÂÖ®Ê°ÜÊû∂ÂíåÊ†áÂáÜ:
‚Ä¢ NIST Cybersecurity Framework 2.0
‚Ä¢ NIST SP 800-61 Rev.3 ‰∫ã‰ª∂ÂìçÂ∫îÊåáÂçó
‚Ä¢ ISO/IEC 27035 ‰ø°ÊÅØÂÆâÂÖ®‰∫ã‰ª∂ÁÆ°ÁêÜ
‚Ä¢ SANS ‰∫ã‰ª∂ÂìçÂ∫îÂÖ≠Ê≠•Ê≥ï

„ÄêÂÖçË¥£Â£∞Êòé - Disclaimer„Äë
Êú¨Êä•ÂëäÂü∫‰∫éËá™Âä®ÂåñÂ∑•ÂÖ∑ÁîüÊàêÔºå‰ªÖ‰æõÂèÇËÄÉ„ÄÇÂª∫ËÆÆÁªìÂêà‰∫∫Â∑•ÂàÜÊûêÂíå‰∏ì‰∏öÂÆâÂÖ®Âõ¢ÈòüÁöÑÂà§Êñ≠ÔºåÂà∂ÂÆöÊúÄÁªàÁöÑÂÆâÂÖ®ÂìçÂ∫îÁ≠ñÁï•„ÄÇÂØπ‰∫éÂÖ≥ÈîÆ‰∏öÂä°Á≥ªÁªüÔºåÂª∫ËÆÆÂí®ËØ¢‰∏ì‰∏öÁöÑÁΩëÁªúÂÆâÂÖ®ÊúçÂä°Êèê‰æõÂïÜ„ÄÇ

---
Êä•ÂëäÁºñÂè∑: IR-${Date.now()}
ÂàÜÁ±ªÁ∫ßÂà´: ÂÜÖÈÉ®‰ΩøÁî®
ÊúâÊïàÊúüÈôê: 30Â§©
  `;
}

function openTab(evt, tabName) {
  const tabcontent = document.getElementsByClassName("tabcontent");
  for (let i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }
  const tablinks = document.getElementsByClassName("tablinks");
  for (let i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }
  document.getElementById(tabName).style.display = "block";
  evt.currentTarget.className += " active";
}

function findAllMatches(text, searchTerm) {
  if (!searchTerm) return [];
  const regex = new RegExp(searchTerm, 'gi');
  const matches = [];
  let match;
  while ((match = regex.exec(text)) !== null) {
    matches.push({
      index: match.index,
      text: match[0],
      position: matches.length,
      end: match.index + match[0].length
    });
  }
  return matches;
}

function searchTabs() {
  const input = document.getElementById("searchInput").value.toLowerCase();
  if (!input) {
    updateSearchCount(0, -1);
    return;
  }

  searchResults = [];
  currentSearchIndex = -1;
  
  const tabs = document.getElementsByClassName("tabcontent");
  for (let i = 0; i < tabs.length; i++) {
    const tabId = tabs[i].id;
    const pres = tabs[i].getElementsByTagName("pre");
    for (let j = 0; j < pres.length; j++) {
      const preText = pres[j].textContent;
      const matches = findAllMatches(preText, input);
      matches.forEach(match => {
        searchResults.push({
          tabId,
          preIndex: j,
          ...match
        });
      });
    }
  }
  
  highlightCurrentMatch();
  updateSearchCount(searchResults.length, currentSearchIndex);
}

function updateSearchCount(total, current) {
  const countElement = document.getElementById("searchCount");
  if (total === 0) {
    countElement.textContent = "Êú™ÊâæÂà∞ÂåπÈÖçÈ°π";
    document.getElementById("prevMatch").disabled = true;
    document.getElementById("nextMatch").disabled = true;
  } else {
    countElement.textContent = `${current + 1}/${total}`;
    document.getElementById("prevMatch").disabled = current <= 0;
    document.getElementById("nextMatch").disabled = current >= total - 1;
  }
}

function navigateSearch(direction) {
  if (searchResults.length === 0) return;
  
  currentSearchIndex += direction;
  if (currentSearchIndex < 0) currentSearchIndex = searchResults.length - 1;
  if (currentSearchIndex >= searchResults.length) currentSearchIndex = 0;
  
  highlightCurrentMatch();
  updateSearchCount(searchResults.length, currentSearchIndex);
}

function highlightCurrentMatch() {
  // Ê∏ÖÈô§ÊâÄÊúâÈ´ò‰∫Æ
  const tabs = document.getElementsByClassName("tabcontent");
  for (let i = 0; i < tabs.length; i++) {
    const pres = tabs[i].getElementsByTagName("pre");
    for (let j = 0; j < pres.length; j++) {
      let html = pres[j].innerHTML.replace(/<span class="mark.*?">(.*?)<\/span>/g, "$1");
      pres[j].innerHTML = html;
    }
  }
  
  if (searchResults.length === 0 || currentSearchIndex === -1) return;
  
  const currentMatch = searchResults[currentSearchIndex];
  
  // ÂàáÊç¢Âà∞ÂØπÂ∫îÁöÑÊ†áÁ≠æÈ°µ
  const tabButton = document.querySelector(`button[onclick="openTab(event, '${currentMatch.tabId}')"]`);
  if (tabButton) {
    tabButton.click();
  }
  
  // È´ò‰∫ÆÊâÄÊúâÂåπÈÖçÈ°πÔºåÂΩìÂâçÂåπÈÖçÈ°πÁâπÊÆäÈ´ò‰∫Æ
  const searchTerm = document.getElementById("searchInput").value;
  const regex = new RegExp(`(${searchTerm})`, 'gi');
  const targetPre = document.getElementById(currentMatch.tabId)
    .getElementsByTagName("pre")[currentMatch.preIndex];
  
  targetPre.innerHTML = targetPre.textContent.replace(regex, (match, p1, offset) => {
    const isCurrentMatch = offset === currentMatch.index;
    return `<span class="mark${isCurrentMatch ? ' current' : ''}">${match}</span>`;
  });
  
  // ÊâæÂà∞ÂΩìÂâçÂåπÈÖçÈ°πÁöÑÂÖÉÁ¥†
  const currentElement = targetPre.querySelector('.mark.current');
  if (currentElement) {
    // Ëé∑ÂèñÁà∂Á∫ßdetailsÂÖÉÁ¥†
    const detailsElement = targetPre.closest('details');
    if (detailsElement && !detailsElement.open) {
      detailsElement.open = true;
    }
    
    // ËÆ°ÁÆóÊªöÂä®‰ΩçÁΩÆ
    const contentContainer = document.querySelector('.content-container');
    const elementRect = currentElement.getBoundingClientRect();
    const containerRect = contentContainer.getBoundingClientRect();
    
    // Ê£ÄÊü•ÂÖÉÁ¥†ÊòØÂê¶Âú®ËßÜÂõæ‰∏≠
    const isInView = (
      elementRect.top >= containerRect.top &&
      elementRect.bottom <= containerRect.bottom
    );
    
    if (!isInView) {
      // ËÆ°ÁÆóÁêÜÊÉ≥ÁöÑÊªöÂä®‰ΩçÁΩÆÔºàÂ∞ÜÂåπÈÖçÈ°πÊîæÂú®ÂÆπÂô®‰∏≠Èó¥Ôºâ
      const elementTop = elementRect.top + contentContainer.scrollTop - containerRect.top;
      const containerMiddle = containerRect.height / 2;
      const scrollTo = elementTop - containerMiddle + elementRect.height / 2;
      
      // Âπ≥ÊªëÊªöÂä®Âà∞ÁõÆÊ†á‰ΩçÁΩÆ
      contentContainer.scrollTo({
        top: scrollTo,
        behavior: 'smooth'
      });
    }
    
    // Ê∑ªÂä†Èó™ÁÉÅÂä®Áîª‰ª•Á™ÅÂá∫ÊòæÁ§∫ÂΩìÂâçÂåπÈÖçÈ°π
    currentElement.style.animation = 'none';
    currentElement.offsetHeight; // Ëß¶ÂèëÈáçÁªò
    currentElement.style.animation = 'highlight-pulse 1s';
  }
}

// Ê∑ªÂä†ËßÑÂàôÂºïÊìéAPIË∞ÉÁî®
async function analyzeReport(data) {
  try {
    // ‰ΩøÁî®Áõ∏ÂØπË∑ØÂæÑÔºåËá™Âä®ÈÄÇÈÖçÂΩìÂâçÂüüÂêçÂíåÁ´ØÂè£
    const response = await fetch('/analyze', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(data)
    });
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const results = await response.json();
    alertResults = results;
    displayAlerts();
  } catch (error) {
    console.error('ËßÑÂàôÂàÜÊûêÂ§±Ë¥•:', error);
    // Â¶ÇÊûúAPIË∞ÉÁî®Â§±Ë¥•Ôºå‰ΩøÁî®Êú¨Âú∞ÂàÜÊûê
    performLocalAnalysis(data);
  }
}

// Êú¨Âú∞ÂàÜÊûêÂäüËÉΩÔºàÂΩìAPI‰∏çÂèØÁî®Êó∂Ôºâ
function performLocalAnalysis(data) {
  const localResults = {
    high: [],
    medium: [],
    low: []
  };
  
  // Ê£ÄÊü•UID‰∏∫0ÁöÑÁî®Êà∑
  if (data.backdoor && data.backdoor['UID‰∏∫0ÁöÑÈùûrootÁî®Êà∑']) {
    const uid0Content = data.backdoor['UID‰∏∫0ÁöÑÈùûrootÁî®Êà∑'];
    if (uid0Content.includes('ÂèØÁñëUID 0Áî®Êà∑') || uid0Content.match(/^(?!root)/m)) {
      localResults.high.push({
        rule_id: 'LOCAL_001',
        section: 'backdoor',
        subsection: 'UID‰∏∫0ÁöÑÈùûrootÁî®Êà∑',
        description: 'ÂèëÁé∞ÂèØÁñëÁöÑUID‰∏∫0Áî®Êà∑',
        severity: 'high',
        recommendation: 'Á´ãÂç≥‰∏éËøêÁª¥ÂíåÂºÄÂèë‰∫∫ÂëòÁ°ÆËÆ§Ëøô‰∫õÁî®Êà∑ÁöÑÂêàÊ≥ïÊÄßÔºåÂ¶ÇÊó†Ê≥ïÁ°ÆËÆ§Â∫îÁ´ãÂç≥Á¶ÅÁî®'
      });
    }
  }
  
  // Ê£ÄÊü•ÂèØÁñëËøõÁ®ã
  if (data.process && data.process['ÂèØÁñëËÑöÊú¨ËøõÁ®ã']) {
    const processes = data.process['ÂèØÁñëËÑöÊú¨ËøõÁ®ã'].split('\n').filter(p => p.trim());
    if (processes.length > 10) {
      localResults.medium.push({
        rule_id: 'LOCAL_002',
        section: 'process',
        subsection: 'ÂèØÁñëËÑöÊú¨ËøõÁ®ã',
        description: `ÂèëÁé∞${processes.length}‰∏™ÂèØÁñëËÑöÊú¨ËøõÁ®ãÔºåÊï∞ÈáèÂºÇÂ∏∏`,
        severity: 'medium',
        recommendation: 'Ê£ÄÊü•Ëøô‰∫õËøõÁ®ãÁöÑÂêàÊ≥ïÊÄßÔºåÁ°ÆËÆ§ÂÖ∂‰∏öÂä°ÂøÖË¶ÅÊÄß'
      });
    }
  }
  
  // Ê£ÄÊü•ÁôªÂΩïÂ§±Ë¥•
  if (data.user && data.user['ÁôªÂΩïÂ§±Ë¥•ËÆ∞ÂΩï']) {
    const failedLogins = data.user['ÁôªÂΩïÂ§±Ë¥•ËÆ∞ÂΩï'];
    const failCount = (failedLogins.match(/Failed password/g) || []).length;
    if (failCount > 50) {
      localResults.medium.push({
        rule_id: 'LOCAL_003',
        section: 'user',
        subsection: 'ÁôªÂΩïÂ§±Ë¥•ËÆ∞ÂΩï',
        description: `ÁôªÂΩïÂ§±Ë¥•Ê¨°Êï∞(${failCount})ÂºÇÂ∏∏ÔºåÂèØËÉΩÂ≠òÂú®Êö¥ÂäõÁ†¥Ëß£ÊîªÂáª`,
        severity: 'medium',
        recommendation: 'Ê£ÄÊü•ÁôªÂΩïÊó•ÂøóÔºåÂä†Âº∫ÂØÜÁ†ÅÁ≠ñÁï•ÂíåËÆøÈóÆÊéßÂà∂'
      });
    }
  }
  
  alertResults = localResults;
  displayAlerts();
  
  // ÊòæÁ§∫Êú¨Âú∞ÂàÜÊûêÊèêÁ§∫
  const container = document.getElementById('alertContainer');
  const localNotice = document.createElement('div');
  localNotice.style.cssText = 'background: #e3f2fd; padding: 10px; margin-bottom: 15px; border-radius: 5px; font-size: 12px; color: #1565c0;';
  localNotice.innerHTML = 'üìç ÂΩìÂâç‰ΩøÁî®Êú¨Âú∞ÂàÜÊûêÊ®°ÂºèÔºåÂäüËÉΩÊúâÈôê„ÄÇÂª∫ËÆÆÂêØÂä®ÂÆåÊï¥ÁöÑËßÑÂàôÂºïÊìéÊúçÂä°Ëé∑ÂæóÊõ¥ÂáÜÁ°ÆÁöÑÂàÜÊûêÁªìÊûú„ÄÇ';
  container.insertBefore(localNotice, container.firstChild);
}

// ‰øÆÊîπrenderTabsÂáΩÊï∞
function renderTabs(data) {
  analysisData = data;
  
  // ÁîüÊàêÁªüËÆ°ÊÄªËßàÊï∞ÊçÆ
  const summaryData = generateSummaryContent(data);
  data.summary = summaryData;
  
  const tabBtnHtml = gTabs.map((k, i) => 
    `<button class="tablinks" onclick="openTab(event, '${k}')">${TAB_TITLES[k]}</button>`
  ).join("");
  document.getElementById("tabBtns").innerHTML = tabBtnHtml;

  const tabContentHtml = gTabs.map(k => {
    const subTitles = SUB_TAB_TITLES[k];
    const subContent = subTitles.map(title => {
      const content = data[k] && data[k][title] ? data[k][title] : "";
      return `<details open><summary>${title}</summary><pre>${escapeHtml(content)}</pre></details>`;
    }).join("");
    return `<div id="${k}" class="tabcontent">${subContent}</div>`;
  }).join("");
  document.getElementById("tabContents").innerHTML = tabContentHtml;

  // ÊòæÁ§∫ÁªüËÆ°Èù¢Êùø
  displayStatsPanel();
  
  if (gTabs.length) {
    setTimeout(() => document.getElementsByClassName("tablinks")[0].click(), 100);
  }
  
  // Ë∞ÉÁî®ËßÑÂàôÂºïÊìéAPIËøõË°åÂàÜÊûê
  analyzeReport(data);
}

// ÊòæÁ§∫ÁªüËÆ°Èù¢Êùø
function displayStatsPanel() {
  const stats = systemStats;
  const statsHtml = `
    <div class="stats-panel">
      <h3>üìä Á≥ªÁªüÂÆâÂÖ®Áä∂ÂÜµÊÄªËßà</h3>
      <div class="risk-level risk-${stats.risk_level.toLowerCase()}">
        È£éÈô©Á≠âÁ∫ß: ${stats.risk_level} (ËØÑÂàÜ: ${stats.risk_score})
      </div>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-number">${stats.total_users}</div>
          <div class="stat-label">ÊÄªÁî®Êà∑Êï∞</div>
        </div>
        <div class="stat-item">
          <div class="stat-number ${stats.uid0_users > 0 ? 'risk-high' : ''}">${stats.uid0_users}</div>
          <div class="stat-label">ÂºÇÂ∏∏È´òÊùÉÈôêÁî®Êà∑</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">${stats.listening_ports}</div>
          <div class="stat-label">ÁõëÂê¨Á´ØÂè£</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">${stats.suspicious_processes}</div>
          <div class="stat-label">ÂèØÁñëËøõÁ®ã</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">${stats.suid_files}</div>
          <div class="stat-label">SUIDÊñá‰ª∂</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">${stats.failed_logins}</div>
          <div class="stat-label">ÁôªÂΩïÂ§±Ë¥•</div>
        </div>
      </div>
    </div>
  `;
  
  // Âú®ÂÜÖÂÆπÂå∫ÂüüÈ°∂ÈÉ®ÊèíÂÖ•ÁªüËÆ°Èù¢Êùø
  const contentContainer = document.querySelector('.content-container');
  const existingStats = contentContainer.querySelector('.stats-panel');
  if (existingStats) {
    existingStats.remove();
  }
  contentContainer.insertAdjacentHTML('afterbegin', statsHtml);
}

function escapeHtml(str) {
  if (!str) return "";
  return str.replace(/[&<>]/g, c => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;" }[c]));
}

document.addEventListener("DOMContentLoaded", function() {
  document.getElementById("fileInput").addEventListener("change", function(e) {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
      try {
        const text = e.target.result;
        try {
          const data = JSON.parse(text);
          renderTabs(data);
        } catch (jsonError) {
          const data = parseTextReport(text);
          renderTabs(data);
        }
      } catch (err) {
        alert("Ëß£ÊûêÂ§±Ë¥•Ôºö" + err.message);
      }
    };
    reader.readAsText(file);
  });
  
  // Ê∑ªÂä†ÊêúÁ¥¢ÂØºËà™‰∫ã‰ª∂ÁõëÂê¨
  document.getElementById("prevMatch").addEventListener("click", () => navigateSearch(-1));
  document.getElementById("nextMatch").addEventListener("click", () => navigateSearch(1));
});

// Ê∑ªÂä†‰æßËæπÊ†èÊäòÂè†ÂäüËÉΩ
function toggleSidebar() {
  const sidebar = document.querySelector('.sidebar');
  const button = document.querySelector('.collapse-button');
  if (sidebar.style.width === '0px') {
    sidebar.style.width = '350px';
    button.textContent = 'Êî∂Ëµ∑ÂëäË≠¶Èù¢Êùø >';
  } else {
    sidebar.style.width = '0px';
    button.textContent = '< Â±ïÂºÄÂëäË≠¶Èù¢Êùø';
  }
}

// Ê∑ªÂä†ÊòæÁ§∫ÂëäË≠¶ÁöÑÂáΩÊï∞
function displayAlerts() {
  const container = document.getElementById('alertContainer');
  const summary = document.getElementById('alertSummary');
  
  // Ê∏ÖÁ©∫Áé∞ÊúâÂÜÖÂÆπ
  container.innerHTML = '';
  summary.innerHTML = '';
  
  // ÊòæÁ§∫ÂëäË≠¶ÁªüËÆ°
  const summaryHtml = `
    <div class="alert-badge high">
      <span>È´òÂç±ÂëäË≠¶</span>
      <span class="count">${alertResults.high.length}</span>
    </div>
    <div class="alert-badge medium">
      <span>‰∏≠Âç±ÂëäË≠¶</span>
      <span class="count">${alertResults.medium.length}</span>
    </div>
    <div class="alert-badge low">
      <span>‰ΩéÂç±ÂëäË≠¶</span>
      <span class="count">${alertResults.low.length}</span>
    </div>
  `;
  summary.innerHTML = summaryHtml;
  
  // ÊòæÁ§∫ÂëäË≠¶ËØ¶ÊÉÖ
  const alertsHtml = [
    ...alertResults.high.map(alert => `
      <div class="alert alert-high">
        <div>
          <strong>${alert.description}</strong>
          <div style="margin-top: 5px; font-size: 12px; color: #666;">
            ËßÑÂàôID: ${alert.rule_id} | Ê®°Âùó: ${alert.section} | Â≠êÈ°π: ${alert.subsection}
          </div>
          ${alert.findings ? `
            <div style="margin-top: 10px;">
              <strong>ÂèëÁé∞:</strong>
              <ul style="margin: 5px 0; padding-left: 20px;">
                ${alert.findings.map(finding => `
                  <li style="cursor: pointer;" onclick="scrollToPosition('${alert.section}', '${alert.subsection}', ${finding.start}, ${finding.end})">
                    ‰ΩçÁΩÆ: ${finding.start}-${finding.end}, ÂåπÈÖçÊñáÊú¨: "${finding.matched_text}"
                  </li>
                `).join('')}
              </ul>
            </div>
          ` : ''}
          ${alert.recommendation ? `
            <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
              <strong>Â§ÑÁΩÆÂª∫ËÆÆ:</strong> ${alert.recommendation}
            </div>
          ` : ''}
        </div>
      </div>
    `),
    ...alertResults.medium.map(alert => `
      <div class="alert alert-medium">
        <div>
          <strong>${alert.description}</strong>
          <div style="margin-top: 5px; font-size: 12px; color: #666;">
            ËßÑÂàôID: ${alert.rule_id} | Ê®°Âùó: ${alert.section} | Â≠êÈ°π: ${alert.subsection}
          </div>
          ${alert.findings ? `
            <div style="margin-top: 10px;">
              <strong>ÂèëÁé∞:</strong>
              <ul style="margin: 5px 0; padding-left: 20px;">
                ${alert.findings.map(finding => `
                  <li style="cursor: pointer;" onclick="scrollToPosition('${alert.section}', '${alert.subsection}', ${finding.start}, ${finding.end})">
                    ‰ΩçÁΩÆ: ${finding.start}-${finding.end}, ÂåπÈÖçÊñáÊú¨: "${finding.matched_text}"
                  </li>
                `).join('')}
              </ul>
            </div>
          ` : ''}
          ${alert.recommendation ? `
            <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
              <strong>Â§ÑÁΩÆÂª∫ËÆÆ:</strong> ${alert.recommendation}
            </div>
          ` : ''}
        </div>
      </div>
    `),
    ...alertResults.low.map(alert => `
      <div class="alert alert-low">
        <div>
          <strong>${alert.description}</strong>
          <div style="margin-top: 5px; font-size: 12px; color: #666;">
            ËßÑÂàôID: ${alert.rule_id} | Ê®°Âùó: ${alert.section} | Â≠êÈ°π: ${alert.subsection}
          </div>
          ${alert.findings ? `
            <div style="margin-top: 10px;">
              <strong>ÂèëÁé∞:</strong>
              <ul style="margin: 5px 0; padding-left: 20px;">
                ${alert.findings.map(finding => `
                  <li style="cursor: pointer;" onclick="scrollToPosition('${alert.section}', '${alert.subsection}', ${finding.start}, ${finding.end})">
                    ‰ΩçÁΩÆ: ${finding.start}-${finding.end}, ÂåπÈÖçÊñáÊú¨: "${finding.matched_text}"
                  </li>
                `).join('')}
              </ul>
            </div>
          ` : ''}
          ${alert.recommendation ? `
            <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
              <strong>Â§ÑÁΩÆÂª∫ËÆÆ:</strong> ${alert.recommendation}
            </div>
          ` : ''}
        </div>
      </div>
    `)
  ].join('');
  
  container.innerHTML = alertsHtml;
}

function scrollToPosition(section, subsection, start, end) {
  // ÂàáÊç¢Âà∞ÂØπÂ∫îÁöÑÊ†áÁ≠æÈ°µ
  const tabButton = document.querySelector(`button[onclick="openTab(event, '${section}')"]`);
  if (tabButton) {
    tabButton.click();
  }
  
  // ÊâæÂà∞ÂØπÂ∫îÁöÑËØ¶ÊÉÖÂÖÉÁ¥†Âπ∂Â±ïÂºÄ
  setTimeout(() => {
    const tabContent = document.getElementById(section);
    if (tabContent) {
      const details = Array.from(tabContent.querySelectorAll('details')).find(d => 
        d.querySelector('summary').textContent.includes(subsection)
      );
      if (details) {
        details.open = true;
        details.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }
  }, 100);
}

</script>
</head>
<body>
  <div class="header">
    <h1>üõ°Ô∏è Linux Â∫îÊÄ•ÂìçÂ∫îÊä•ÂëäÊü•ÁúãÂô® (Â¢ûÂº∫Áâà)</h1>
    <div class="subtitle">Êô∫ËÉΩÂåñÂÆâÂÖ®Â®ÅËÉÅÊ£ÄÊµã‰∏éÂàÜÊûêÁ≥ªÁªü | ‰øùÁïôÂéüÊúâÂäüËÉΩ + Â¢ûÂº∫ÁªüËÆ°ÂàÜÊûê</div>
  </div>
  
  <div class="main-container">
    <div class="content-container">
      <div class="search-container">
        <input type="file" id="fileInput" accept=".txt,.json">
        <input type="text" id="searchInput" placeholder="ÊêúÁ¥¢Êä•ÂëäÂÜÖÂÆπ..." onkeyup="searchTabs()">
        <div class="search-nav">
          <button id="prevMatch" onclick="navigateSearch(-1)" disabled>‰∏ä‰∏Ä‰∏™</button>
          <button id="nextMatch" onclick="navigateSearch(1)" disabled>‰∏ã‰∏Ä‰∏™</button>
          <span id="searchCount">ËæìÂÖ•ÂÖ≥ÈîÆËØçÊêúÁ¥¢</span>
        </div>
      </div>
      
      <div class="tabs" id="tabBtns">
        <!-- Ê†áÁ≠æÊåâÈíÆÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
      </div>
      
      <div id="tabContents">
        <!-- Ê†áÁ≠æÂÜÖÂÆπÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
      </div>
    </div>
    
    <div class="sidebar">
      <div class="sidebar-header">
        <h3>üö® ÂÆâÂÖ®ÂëäË≠¶Èù¢Êùø</h3>
        <button class="collapse-button" onclick="toggleSidebar()">Êî∂Ëµ∑ÂëäË≠¶Èù¢Êùø ></button>
        <div id="alertSummary" class="alert-summary">
          <!-- ÂëäË≠¶ÁªüËÆ°Â∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
        </div>
      </div>
      <div id="alertContainer" class="alert-container">
        <div style="text-align: center; padding: 40px; color: #666;">
          <p>üìÅ ËØ∑ÈÄâÊã©Êä•ÂëäÊñá‰ª∂ÂºÄÂßãÂàÜÊûê</p>
          <p style="font-size: 0.9em; margin-top: 10px;">ÊîØÊåÅ .txt Âíå .json Ê†ºÂºè</p>
        </div>
      </div>
    </div>
  </div>
</body>
</html>